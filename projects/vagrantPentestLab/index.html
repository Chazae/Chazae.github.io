<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta name="google-site-verification" content=""> <meta name="msvalidate.01" content=""> <meta http-equiv="Permissions-Policy" content="interest-cohort=()"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Quick Deploy Pentest Lab with Vagrant | Chase Sharp </title> <meta name="author" content="Chase Sharp"> <meta name="description" content="Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://chazae.github.io/projects/vagrantPentestLab/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Chase</span> Sharp </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">Resume/CV </a> </li> <li class="nav-item active"> <a class="nav-link" href="/projects/">Projects <span class="sr-only">(current)</span> </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link">search <i class="ti ti-search"></i></span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> <title>Quick Deploy Pentest Lab with Vagrant | blank</title> <meta name="generator" content="Jekyll v4.3.4"> <meta property="og:title" content="Quick Deploy Pentest Lab with Vagrant"> <meta property="og:locale" content="en"> <meta name="description" content="Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant"> <meta property="og:description" content="Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant"> <link rel="canonical" href="https://chazae.github.io/projects/vagrantPentestLab/"> <meta property="og:url" content="https://chazae.github.io/projects/vagrantPentestLab/"> <meta property="og:site_name" content="blank"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2025-04-14T21:53:45+00:00"> <meta name="twitter:card" content="summary"> <meta property="twitter:title" content="Quick Deploy Pentest Lab with Vagrant"> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-14T21:53:45+00:00","datePublished":"2025-04-14T21:53:45+00:00","description":"Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant","headline":"Quick Deploy Pentest Lab with Vagrant","mainEntityOfPage":{"@type":"WebPage","@id":"https://chazae.github.io/projects/vagrantPentestLab/"},"url":"https://chazae.github.io/projects/vagrantPentestLab/"}</script> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Quick Deploy Pentest Lab with Vagrant</h1> <p class="post-description">Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant</p> <title>Quick Deploy Pentest Lab with Vagrant | blank</title> <meta name="generator" content="Jekyll v4.3.4"> <meta property="og:title" content="Quick Deploy Pentest Lab with Vagrant"> <meta property="og:locale" content="en"> <meta name="description" content="Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant"> <meta property="og:description" content="Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant"> <link rel="canonical" href="https://chazae.github.io/projects/vagrantPentestLab/"> <meta property="og:url" content="https://chazae.github.io/projects/vagrantPentestLab/"> <meta property="og:site_name" content="blank"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2025-04-14T21:53:45+00:00"> <meta name="twitter:card" content="summary"> <meta property="twitter:title" content="Quick Deploy Pentest Lab with Vagrant"> <script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2025-04-14T21:53:45+00:00","datePublished":"2025-04-14T21:53:45+00:00","description":"Building a Quickly Deployable Red Team/Blue Team Lab with Vagrant","headline":"Quick Deploy Pentest Lab with Vagrant","mainEntityOfPage":{"@type":"WebPage","@id":"https://chazae.github.io/projects/vagrantPentestLab/"},"url":"https://chazae.github.io/projects/vagrantPentestLab/"}</script> </header> <article> <h3 id="software-used">Software Used</h3> <p>Virtual Box [<a href="https://www.virtualbox.org/" rel="external nofollow noopener" target="_blank">https://www.virtualbox.org/</a>]</p> <p>-Version Used: 7.1.4</p> <p>-Update PATH variable to include the Virtual Box Directory</p> <p>-VBoxManage is used multiple times</p> <p>Vagrant [<a href="https://www.vagrantup.com/" rel="external nofollow noopener" target="_blank">https://www.vagrantup.com/</a>]</p> <p>-Version Used: 2.4.3</p> <h2 id="before-we-begin">Before we Begin</h2> <p>If you are planning on implementing Windows Operating Systems into your environment, please read my guide on how to setup a Windows Base Box first. This guide assumes that you already have your base-boxes present.</p> <p>LINK WINDOWS BASE BOX TO GUIDE &lt;<a href="https://chazae.github.io/">https://chazae.github.io/</a>&gt;</p> <p>The workflow I found most effective for preparing a multi-machine vagrant environment is to boot/configure the Vagrantfile of any new operating system you would like to add to the lab environment.</p> <p>After successfully booting the OS through vagrant using a single-machine vagrantfile then you can easily transfer that config to a multi-machine environment by placing the specifications under</p> <hr> <h2 id="red-team-host">Red-Team Host</h2> <ul> <li>Kali - <ul> <li>hashicorp cloud link <ul> <li><a href="https://portal.cloud.hashicorp.com/vagrant/discover/kalilinux/rolling" rel="external nofollow noopener" target="_blank">https://portal.cloud.hashicorp.com/vagrant/discover/kalilinux/rolling</a></li> </ul> </li> <li>Vagrantfile configuration</li> </ul> </li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="vg">$script</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">SCRIPT</span><span class="sh">
  sudo apt-get -y purge network-manager &gt; /dev/null
  sudo ifdown eth0 &amp;2&gt;/dev/null &amp;
  sudo ip link set eth1 up
  sudo ip route del default dev eth0
  sudo ip route add default dev eth1
  sudo ip addr add 192.168.30.2/24 dev eth1 &amp;&gt;/dev/null &amp;
</span><span class="no">  SCRIPT</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"kali"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">primary: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">kali</span><span class="o">|</span>
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"kalilinux/rolling"</span>
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> 
			<span class="ss">auto_config: </span><span class="kp">false</span>
		
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
			<span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"kaliVagrant"</span>
			<span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">true</span>
			<span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"2048"</span>
		<span class="k">end</span>
		
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">run: </span><span class="s2">"always"</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
			<span class="n">s</span><span class="p">.</span><span class="nf">inline</span> <span class="o">=</span> <span class="vg">$script</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <hr> <h2 id="only-one-host-is-necessary">Only one host is necessary</h2> <h3 id="blue-team-linux-os-options">Blue-Team: Linux OS Options</h3> <ul> <li>Ubuntu Host - <a href="https://ubuntu.com/" rel="external nofollow noopener" target="_blank">https://ubuntu.com/</a> <ul> <li>hashicorp box link <ul> <li><a href="https://portal.cloud.hashicorp.com/vagrant/discover/ubuntu/xenial64" rel="external nofollow noopener" target="_blank">https://portal.cloud.hashicorp.com/vagrant/discover/ubuntu/xenial64</a></li> </ul> </li> <li>Vagrantfile Configuration</li> </ul> </li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"ubuntuHost"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">ubuntuHost</span><span class="o">|</span>
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"hashicorp/precise64"</span>
	    <span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="s2">"1.1.0"</span>
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.180"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span><span class="p">,</span> <span class="ss">auto_config: </span><span class="kp">true</span>
		
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"ubuntuHostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm ubuntuHostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <ul> <li>Ubuntu Server <ul> <li>hashicorp box link <ul> <li><a href="https://portal.cloud.hashicorp.com/vagrant/discover/ubuntu/trusty64" rel="external nofollow noopener" target="_blank">https://portal.cloud.hashicorp.com/vagrant/discover/ubuntu/trusty64</a></li> </ul> </li> <li>Vagrantfile Configuration</li> </ul> </li> </ul> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="c1"># Defines an ubuntu server as "web"</span>
  <span class="c1"># Downloads an ubuntuServer box from the hasicorp cloud</span>
  <span class="c1"># after vagrant is done with initilization it sets the network address to private</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"ubuntuServer"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">ubuntuServer</span><span class="o">|</span>
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"ubuntu/trusty64"</span>
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="s2">"20191107.0.0"</span>
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.170"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span><span class="p">,</span> <span class="ss">auto_config: </span><span class="kp">true</span>
		
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"ubuntuServerVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
	
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm ubuntuServerVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <hr> <h3 id="blue-team-windows-os-options">Blue-Team: Windows OS Options</h3> <p><strong>Disclaimer - I am not suggesting to do this in a professional setting. This is for home network use only.</strong></p> <h3 id="windows-iso-acquisition">Windows ISO Acquisition</h3> <p>Windows</p> <ul> <li>Newer versions can be done through EVAL</li> <li>This website has hashes that may be able to help you find any version of Windows you need for non-professional use. <ul> <li><a href="https://www.heidoc.net/php/myvsdump.php" rel="external nofollow noopener" target="_blank">https://www.heidoc.net/php/myvsdump.php</a></li> </ul> </li> </ul> <hr> <h2 id="windows-hosts">Windows Hosts</h2> <h3 id="windows-7-vagrantfile-configuration">Windows 7 Vagrantfile configuration</h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"windows7Host"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">windows7Host</span><span class="o">|</span>
	  <span class="c1">#Name the box found in "PS ...\vagrant\&gt;vagrant box list" </span>
			<span class="c1">#If not found then the command will attempt to install it from URL/Local Path below</span>
		<span class="c1">#Point to the box from wherever this Vagrantfile is launched</span>
		<span class="c1">#forward the port required for RDP</span>
		<span class="c1">#create a private network NIC, assign IP, and assign it to named network "pentestLab"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows7Base"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows7BaseBox/windows7Base.box"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">33389</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">3389</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.151"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> 
			<span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows7HostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows7HostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <h3 id="windows-10-vagrantfile-configuration">Windows 10 Vagrantfile configuration</h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"windows10Host"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">windows10Host</span><span class="o">|</span>
		<span class="c1">#Name the box found in "PS ...\vagrant\&gt;vagrant box list" </span>
			<span class="c1">#If not found then the command will attempt to install it from URL/Local Path below</span>
		<span class="c1">#Point to the box from wherever this Vagrantfile is launched</span>
		<span class="c1">#forward the port required for RDP</span>
		<span class="c1">#create a private network NIC, assign IP, and assign it to a named network</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows10Base"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows10BaseBox/windows10Base.box"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.152"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="c1">#name the virtual machine</span>
		<span class="c1">#launch without a VirtualBox View</span>
		<span class="c1">#set RAM to 1gb</span>
		<span class="c1">#"plug" back in the virtual NIC that allows vagrant to communicate via SSH [NAT NIC]</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows10HostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="c1">#Establish winrm as the communicator (Default is usually SSH)</span>
		<span class="c1">#initialize winrm username</span>
		<span class="c1">#initialize winrm password</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="c1">#Turn off the virtual NIC after vagrant "up" command to contain private network</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows10HostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <h3 id="windows-11-vagrantfile-configuration">Windows 11 Vagrantfile configuration</h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"windows11Host"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">windows11Host</span><span class="o">|</span>
		<span class="c1">#Name the box found in "PS ...\vagrant\&gt;vagrant box list" </span>
			<span class="c1">#If not found then the command will attempt to install it from URL/Local Path below</span>
		<span class="c1">#Point to the box from wherever this Vagrantfile is launched</span>
		<span class="c1">#forward the port required for RDP</span>
		<span class="c1">#create a private network NIC, assign IP, and assign it to a named network</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows11Base"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows11BaseBox/windows11Base.box"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.153"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="c1">#name the virtual machine</span>
		<span class="c1">#launch without a VirtualBox View</span>
		<span class="c1">#set RAM to 1gb</span>
		<span class="c1">#"plug" back in the virtual NIC that allows vagrant to communicate via SSH [NAT NIC]</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows11HostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="c1">#Establish winrm as the communicator (Default is usually SSH)</span>
		<span class="c1">#initialize winrm username</span>
		<span class="c1">#initialize winrm password</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="c1">#Turn off the virtual NIC after vagrant "up" command to contain private network</span>
			<span class="c1">#uses Virtual Machine name set above</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows11HostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <hr> <h2 id="windows-servers">Windows Servers</h2> <p>These instructions BELOW configure a windows server with BARE FUNCTIONALITY and NO ROLES</p> <p>If you would like to ADD ROLES such as (Active Directory, DHCP, Web, etc.) then I suggest provisioning the machines using chef-solo</p> <h3 id="creating-a-windows-server-2022-base-box">Creating a Windows Server 2022 Base Box</h3> <h3 id="windows-server-2022-vagrantfile-configuration">Windows Server 2022 Vagrantfile configuration</h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"db"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">db</span><span class="o">|</span>
		<span class="c1">#Name the box found in "PS ...\vagrant\&gt;vagrant box list" </span>
			<span class="c1">#If not found then the command will attempt to install it from URL/Local Path below</span>
		<span class="c1">#Point to the box from wherever this Vagrantfile is launched</span>
		<span class="c1">#forward the port required for RDP</span>
		<span class="c1">#create a private network NIC, assign IP, and assign it to named network "pentestLab"</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows2022Base"</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows2022BaseBox/windows2022Base.box"</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"forwarded_port"</span><span class="p">,</span> <span class="ss">host: </span><span class="mi">33389</span><span class="p">,</span> <span class="ss">guest: </span><span class="mi">3389</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.160"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> 
			<span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="c1">#name the virtual machine</span>
		<span class="c1">#launch without a VirtualBox View</span>
		<span class="c1">#set RAM to 1gb</span>
		<span class="c1">#"plug" back in the virtual NIC that allows vagrant to communicate via SSH [NAT NIC]</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows2022Vagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="c1">#Establish winrm as the communicator (Default is usually SSH)</span>
		<span class="c1">#initialize winrm username</span>
		<span class="c1">#initialize winrm password</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="c1">#Turn off the virtual NIC after vagrant "up" command to contain private network</span>
		<span class="n">db</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows2022Vagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <h3 id="windows-server-2012-vagrantfile-configuration">Windows Server 2012 Vagrantfile configuration</h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"win2k12Server"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">win2k12Server</span><span class="o">|</span>
		<span class="c1">#Name the box found in "PS ...\vagrant\&gt;vagrant box list" </span>
			<span class="c1">#If not found then the command will attempt to install it from URL/Local Path below</span>
		<span class="c1">#Point to the box from wherever this Vagrantfile is launched</span>
		<span class="c1">#forward the port required for RDP</span>
		<span class="c1">#create a private network NIC, assign IP, and assign it to a named network</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows2012Base"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows2012BaseBox/windows2012Base.box"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.161"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="c1">#name the virtual machine</span>
		<span class="c1">#launch without a VirtualBox View</span>
		<span class="c1">#set RAM to 1gb</span>
		<span class="c1">#"plug" back in the virtual NIC that allows vagrant to communicate via SSH [NAT NIC]</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows2012Vagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="c1">#Establish winrm as the communicator (Default is usually SSH)</span>
		<span class="c1">#initialize winrm username</span>
		<span class="c1">#initialize winrm password</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="c1">#Turn off the virtual NIC after vagrant "up" command to contain private network</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows2012Vagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <h3 id="windows-server-2008-vagrantfile-configuration">Windows Server 2008 Vagrantfile configuration</h3> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"win2k8Server"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">win2k8Server</span><span class="o">|</span>
		<span class="c1">#Name the box found in "PS ...\vagrant\&gt;vagrant box list" </span>
			<span class="c1">#If not found then the command will attempt to install it from URL/Local Path below</span>
		<span class="c1">#Point to the box from wherever this Vagrantfile is launched</span>
		<span class="c1">#forward the port required for RDP</span>
		<span class="c1">#create a private network NIC, assign IP, and assign it to a named network</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows2k8Base"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows2008BaseBox/windows2008Base.box"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.162"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="c1">#name the virtual machine</span>
		<span class="c1">#launch without a VirtualBox View</span>
		<span class="c1">#set RAM to 1gb</span>
		<span class="c1">#"plug" back in the virtual NIC that allows vagrant to communicate via SSH [NAT NIC]</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows2008R2Vagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
			<span class="c1">#Establish winrm as the communicator (Default is usually SSH)</span>
		<span class="c1">#initialize winrm username</span>
		<span class="c1">#initialize winrm password</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="c1">#Turn off the virtual NIC after vagrant "up" command to contain private network</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows2008R2Vagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
</code></pre></div></div> <hr> <h2 id="multi-machine-vagrantfile-configuration">Multi-Machine Vagrantfile Configuration</h2> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Vagrant</span><span class="p">.</span><span class="nf">configure</span><span class="p">(</span><span class="s2">"2"</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

  <span class="c1"># Defines the primary kali box</span>
  <span class="c1"># Only box initially ran</span>
  <span class="c1"># Set on private ip once initialized</span>
  <span class="c1"># Provision will run a shell that will reinitialize the eth0 interace, which is the default interface setup</span>
	<span class="c1"># This is important as without this, kali will be able to ping computers </span>
	<span class="c1"># in your internal network while also being able to communicate to the internet</span>
  
  <span class="vg">$scriptKali</span> <span class="o">=</span> <span class="o">&lt;&lt;-</span><span class="no">SCRIPT</span><span class="sh">
  sudo apt-get -y purge network-manager &gt; /dev/null
  sudo ifdown eth0 &amp;2&gt;/dev/null &amp;
  sudo ip link set eth1 up &gt; /dev/null
  sudo ip route del default dev eth0
  sudo ip route add default dev eth1
  sudo ip addr add 192.168.30.2/24 dev eth1 &amp;&gt;/dev/null &amp;
  exit
</span><span class="no">  SCRIPT</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"kali"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">primary: </span><span class="kp">true</span> <span class="k">do</span> <span class="o">|</span><span class="n">kali</span><span class="o">|</span>
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"kalilinux/rolling"</span>
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">auto_config: </span><span class="kp">false</span>
		
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
			<span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"kaliVagrant"</span>
			<span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">true</span>
			<span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"2048"</span>
			<span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">kali</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provision</span> <span class="s2">"shell"</span><span class="p">,</span> <span class="ss">run: </span><span class="s2">"always"</span> <span class="k">do</span> <span class="o">|</span><span class="n">s</span><span class="o">|</span>
			<span class="n">s</span><span class="p">.</span><span class="nf">inline</span> <span class="o">=</span> <span class="vg">$scriptKali</span>
		<span class="k">end</span>
		
		<span class="n">kali</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm kaliVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  

  <span class="c1"># Defines the Windows 7 box as "windows7" which will be a host</span>
  <span class="c1"># uses winrm instead of ssh so it must be defined</span>
  <span class="c1"># after vagrant is done with initilization it sets the network address to private</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"windows7Host"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">windows7Host</span><span class="o">|</span>
		<span class="c1">#Name the box found in "PS ...\vagrant\&gt;vagrant box list" </span>
			<span class="c1">#If not found then the command will attempt to install it from URL/Local Path below</span>
		<span class="c1">#Point to the box from wherever this Vagrantfile is launched</span>
		<span class="c1">#forward the port required for RDP</span>
		<span class="c1">#create a private network NIC, assign IP, and assign it to a named network</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows7Base"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows7BaseBox/windows7Base.box"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.151"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="c1">#name the virtual machine</span>
		<span class="c1">#launch without a VirtualBox View</span>
		<span class="c1">#set RAM to 1gb</span>
		<span class="c1">#"plug" back in the virtual NIC that allows vagrant to communicate via SSH [NAT NIC]</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows7HostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="c1">#Establish winrm as the communicator (Default is usually SSH)</span>
		<span class="c1">#initialize winrm username</span>
		<span class="c1">#initialize winrm password</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="c1">#Turn off the virtual NIC after vagrant "up" command to contain private network</span>
		<span class="n">windows7Host</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows7HostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"windows10Host"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">windows10Host</span><span class="o">|</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows10Base"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows10BaseBox/windows10Base.box"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.152"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows10HostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="n">windows10Host</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows10HostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"windows11Host"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">windows11Host</span><span class="o">|</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows11Base"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows11BaseBox/windows11Base.box"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.153"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
				
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows11HostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="n">windows11Host</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows11HostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"win2k22Server"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">win2k22Server</span><span class="o">|</span>
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows2022Base"</span>
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows2022BaseBox/windows2022Base.box"</span>
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.160"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
		
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows2022Vagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="n">win2k22Server</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows2022Vagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"win2k12Server"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">win2k12Server</span><span class="o">|</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows2012Base"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows2012BaseBox/windows2012Base.box"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.161"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
				
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows2012Vagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="n">win2k12Server</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows2012Vagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"win2k8Server"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">win2k8Server</span><span class="o">|</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"windows2k8Base"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_url</span> <span class="o">=</span> <span class="s2">"windows2008BaseBox/windows2008Base.box"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.162"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span>
				
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"windows2008R2Vagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">communicator</span> <span class="o">=</span> <span class="s2">"winrm"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">username</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">winrm</span><span class="p">.</span><span class="nf">password</span> <span class="o">=</span> <span class="s2">"vagrant"</span>
		
		<span class="n">win2k8Server</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm windows2008R2Vagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  
  <span class="c1"># Defines an ubuntu server as "web"</span>
  <span class="c1"># Downloads an ubuntuServer box from the hasicorp cloud</span>
  <span class="c1"># after vagrant is done with initilization it sets the network address to private</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"ubuntuServer"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">ubuntuServer</span><span class="o">|</span>
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"ubuntu/trusty64"</span>
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="s2">"20191107.0.0"</span>
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.170"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span><span class="p">,</span> <span class="ss">auto_config: </span><span class="kp">true</span>
		
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"ubuntuServerVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
	
		<span class="n">ubuntuServer</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm ubuntuServerVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
  
  <span class="c1"># Defines an ubuntu Host as "ubuntuHost"</span>
  <span class="c1"># Downloads an ubuntu Host box from the hasicorp cloud</span>
  <span class="c1"># after vagrant is done with initilization it sets the network address to private</span>
  
  <span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"ubuntuHost"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">ubuntuHost</span><span class="o">|</span>
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box</span> <span class="o">=</span> <span class="s2">"hashicorp/precise64"</span>
	    <span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">box_version</span> <span class="o">=</span> <span class="s2">"1.1.0"</span>
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">network</span> <span class="s2">"private_network"</span><span class="p">,</span> <span class="ss">ip: </span><span class="s2">"192.168.30.180"</span><span class="p">,</span> <span class="ss">adapter: </span><span class="mi">2</span><span class="p">,</span> <span class="ss">virtualbox__intnet: </span><span class="s2">"pentestLab"</span><span class="p">,</span> <span class="ss">auto_config: </span><span class="kp">true</span>
		
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">provider</span> <span class="s2">"virtualbox"</span> <span class="k">do</span> <span class="o">|</span><span class="n">vb</span><span class="o">|</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">name</span> <span class="o">=</span> <span class="s2">"ubuntuHostVagrant"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">gui</span> <span class="o">=</span> <span class="kp">false</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">memory</span> <span class="o">=</span> <span class="s2">"1024"</span>
		  <span class="n">vb</span><span class="p">.</span><span class="nf">customize</span> <span class="s1">'post-boot'</span><span class="p">,</span> <span class="p">[</span><span class="s2">"controlvm"</span><span class="p">,</span> <span class="ss">:id</span><span class="p">,</span> <span class="s2">"setlinkstate1"</span><span class="p">,</span> <span class="s2">"on"</span><span class="p">]</span>
		<span class="k">end</span>
		
		<span class="n">ubuntuHost</span><span class="p">.</span><span class="nf">trigger</span><span class="p">.</span><span class="nf">after</span> <span class="s2">"up"</span> <span class="k">do</span> <span class="o">|</span><span class="n">t</span><span class="o">|</span>
			<span class="n">t</span><span class="p">.</span><span class="nf">run</span> <span class="o">=</span> <span class="p">{</span><span class="ss">inline: </span><span class="s1">'VBoxManage controlvm ubuntuHostVagrant setlinkstate1 off'</span><span class="p">}</span>
		<span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div> <h3 id="multi-machine-vagrantfile-configuration-explanation">Multi-Machine Vagrantfile Configuration Explanation</h3> <p>When defining a Multi-Machine Vagrantfile, the only real differences are how “vagrant up” is used, which is controlled by the <strong><em>autostart: false</em></strong> configuration option.</p> <p>In the case of the ubuntuHost this is shown as:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">config</span><span class="p">.</span><span class="nf">vm</span><span class="p">.</span><span class="nf">define</span> <span class="s2">"ubuntuHost"</span><span class="p">,</span> <span class="ss">autostart: </span><span class="kp">false</span> <span class="k">do</span> <span class="o">|</span><span class="n">ubuntuHost</span><span class="o">|</span>
</code></pre></div></div> <p>This is required as using “vagrant up” will bring up every single virtual machine listed in the Multi-Machine Vagrantfile unless explicitly told not to. This switch allows you to customize your lab on the fly, and quickly configure a large amount of environments.</p> <h1 id="usage">Usage</h1> <p>vagrant up</p> <p>Brings up all of the boxes without the <strong><em>autoconfig: false</em></strong> property set</p> <p>vagrant up <box name=""></box></p> <p>Only brings up the specified Virtual Machine</p> <p>vagrant suspend -f</p> <p>Suspends all machines for future use.</p> <p>vagrant halt -f</p> <p>Halts all currently running Virtual Machines, and does so through the Hypervisor as opposed to an ssh shutdown command. As this environment is private, and not meant to communicate post setup, the -f switch is required.</p> <p>vagrant destroy -f</p> <p>Destroys all virtual machines created. This is used when you are done with the lab as a whole, and would like to start entirely fresh. -f switch is used for a similar purpose</p> <h3 id="demonstration">Demonstration</h3> <video src="assets/video/vagrantPentestLab.mp4" controls=""></video> <h2 id="pentest-lab-internal-network-topology">Pentest Lab Internal Network Topology</h2> <image src="assets/img/pentestlab_project/networkTopology.png" width="320" height="240" controls=""></image> <hr> <h2 id="strengths-of-this-approach">Strengths of this approach</h2> <p>Less disk space is used</p> <ul> <li>vagrant boxes are more lightweight than a traditional VM</li> <li>The fast setup of labs allows you to delete them when unused with <strong><em>vagrant destroy -f</em></strong> </li> </ul> <p>Low setup time for additional labs</p> <ul> <li>Now that this platform is initialized, setting up a specific lab is as easy as changing this configuration file</li> </ul> <p>High amount of customization</p> <ul> <li>Easily add, change, or delete configs that you do not need</li> </ul> <h2 id="weaknesses-of-this-approach">Weaknesses of this approach</h2> <p>Vagrants NAT requirement</p> <ul> <li>Upon starting up a machine with <strong><em>vagrant up</em></strong> vagrant will enable the first NIC as NAT and connect it to the machine</li> <li>As we want our lab to be completely private, the configuration above will disconnect the cable but this only happens once the machine is completely booted up.</li> </ul> <p>Static IP’s for hosts are not realistic in a business setting</p> <hr> <h2 id="what-i-learned">What I learned</h2> <p>Configuring network settings through SSH that will effectively close your SSH connection is tricky. I had to set some commands as a background process, and trust that the exit command executed prior to being kicked. This allows the script to run without waiting for a response from the Kali box.</p> <p>Network Manager is a pain to work with when trying to set up a golden configuration.</p> <p>vagrant needs to work on removing the requirement for the first interface being NAT. While other options exist, vagrant makes for a wonderful virtual machine manager by combining cloud-based</p> <hr> <h2 id="what-is-next-for-this-lab">What Is Next For This Lab?</h2> <p>As of right now this lab is fully functional for a basic demo involving metasploit. While that lab would be quick and fun, I want to brush up on my software provisioning skills. My next goal is to provision an Ubuntu Server within this lab to automatically download and setup OWASP Juice Shop.</p> <p>This is for two reasons.</p> <p>The first being that I want to demonstrate my ability to provision software across multiple devices using chef.</p> <p>The second reason being that I would like to practice web application vulnerability once I have successfully setup software provisioning for my virtual machines.</p> <hr> <h2 id="various-guidesposts-i-used-during-setup">Various guides/posts I used during setup</h2> <p>Guides referenced</p> <ul> <li>Windows Vagrant File Configuration [<a href="https://vitaminac.github.io/Windows7-Vagrant/" rel="external nofollow noopener" target="_blank">https://vitaminac.github.io/Windows7-Vagrant/</a>]</li> </ul> <p>Guides referenced in showcase</p> <ul> <li>Windows Vagrant File Configuration <ul> <li><a href="https://vitaminac.github.io/Windows7-Vagrant/" rel="external nofollow noopener" target="_blank">https://vitaminac.github.io/Windows7-Vagrant/</a></li> </ul> </li> <li>Vagrant Multi-machine <ul> <li><a href="https://developer.hashicorp.com/vagrant/docs/multi-machine" rel="external nofollow noopener" target="_blank">https://developer.hashicorp.com/vagrant/docs/multi-machine</a></li> </ul> </li> <li>VBoxManage commands <ul> <li><a href="https://www.virtualbox.org/manual/ch08.html#vboxmanage-modifyvm" rel="external nofollow noopener" target="_blank">https://www.virtualbox.org/manual/ch08.html#vboxmanage-modifyvm</a></li> </ul> </li> <li>solution to NIC resetting in kali <ul> <li><a href="https://askubuntu.com/questions/646506/network-configuration-ip-address-resets-spontaneously" rel="external nofollow noopener" target="_blank">https://askubuntu.com/questions/646506/network-configuration-ip-address-resets-spontaneously</a></li> </ul> </li> </ul> </article> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025 Chase Sharp. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Last updated: April 14, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?70d799092f862ad98c7876aa47712e20"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script defer src="/assets/js/google-analytics-setup.js?12374742c4b1801ba82226e617af7e2d"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>